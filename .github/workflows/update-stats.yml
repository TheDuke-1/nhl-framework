name: Update NHL Stats Daily                                                                                                                       
                                                                                                                                                     
  on:                                                                                                                                                
    schedule:                                                                                                                                        
      - cron: '0 11 * * *'                                                                                                                           
    workflow_dispatch:                                                                                                                               
                                                                                                                                                     
  jobs:                                                                                                                                              
    update-stats:                                                                                                                                    
      runs-on: ubuntu-latest                                                                                                                         
      permissions:                                                                                                                                   
        contents: write                                                                                                                              
      steps:                                                                                                                                         
        - uses: actions/checkout@v4                                                                                                                  
        - uses: actions/setup-python@v5                                                                                                              
          with:                                                                                                                                      
            python-version: '3.11'                                                                                                                   
        - run: pip install -r scripts/requirements.txt                                                                                               
        - run: python scripts/fetch_nhl_api.py                                                                                                       
          continue-on-error: true                                                                                                                    
        - run: python scripts/fetch_moneypuck.py                                                                                                     
          continue-on-error: true                                                                                                                    
        - run: python scripts/scrape_nst.py                                                                                                          
          continue-on-error: true                                                                                                                    
        - run: python scripts/merge_data.py                                                                                                          
        - name: Commit updates                                                                                                                       
          run: |                                                                                                                                     
            git config user.name "GitHub Actions"                                                                                                    
            git config user.email "actions@github.com"                                                                                               
            git add data/                                                                                                                            
            git diff --staged --quiet || git commit -m "Update stats $(date +%Y-%m-%d)"                                                              
            git push
